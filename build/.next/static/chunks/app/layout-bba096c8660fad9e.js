(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6815:function(e,t,a){Promise.resolve().then(a.t.bind(a,8877,23)),Promise.resolve().then(a.bind(a,5358)),Promise.resolve().then(a.bind(a,4080)),Promise.resolve().then(a.t.bind(a,7021,23)),Promise.resolve().then(a.t.bind(a,4321,23))},5358:function(e,t,a){"use strict";a.d(t,{I:function(){return p},TransactionProvider:function(){return u}});var n=a(7437),o=a(2265),s=a(7084),r=a(4080);a(8477);var i=a(5262);let c=(0,o.createContext)(),d={isLoading:!1,transactions:[],error:{},balance:0,order:{orderId:"",paymentId:"",signature:""},paginationData:{currentPage:1,totalPages:1,totalTransactions:0}};function l(e,t){switch(t.type){case"isLoading":return{...e,isLoading:!0};case"getTransactions":return{...e,transactions:t.payload,isLoading:!1};case"getBalance":return{...e,balance:t.payload,isLoading:!1};case"rejected":return{...e,error:t.payload,isLoading:!1};case"setOrder":return{...e,order:t.payload,isLoading:!1};case"setPaginationData":return{...e,paginationData:t.payload,isLoading:!1};default:return"unknown action type"}}function u(e){let{children:t}=e,[{transactions:a,isLoading:u,balance:p,error:y,paginationData:g},m]=(0,o.useReducer)(l,d),{isLoggedIn:h,setPremium:f}=(0,r.a)(),L=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{m({type:"isLoading"});let t=await s.Z.get("/api/v1/accounts/myAccount",{params:{page:e}});console.log(t),m({type:"getTransactions",payload:t.data.data.myTransaction}),m({type:"getBalance",payload:t.data.balance}),m({type:"setPaginationData",payload:{currentPage:e,totalPages:t.data.totalPages,totalTransactions:t.data.myTransaction}})}catch(e){m({type:"rejected",payload:e.data})}});async function w(e){try{m({type:"isLoading"});let t=await s.Z.post("api/v1/accounts/addExpense",e);if("success"===t.data.status){let e=t.data.data.newExpense;console.log(e);let n=[...a,e],o="debit"===e.transactionType?p-parseInt(e.amount):p+parseInt(e.amount);m({type:"getTransactions",payload:n}),console.log(p),m({type:"getBalance",payload:o})}}catch(e){m({type:"rejected",payload:e.response.data})}}async function v(e){try{m({type:"isLoading"});let t=await s.Z.delete("/api/v1/accounts/editExpense/".concat(e));if("success"===t.data.status){let t=a.find(t=>t.id===e),n=p+Number(t.amount),o=a.filter(t=>t.id!==e);m({type:"getTransactions",payload:o}),m({type:"getBalance",payload:n})}}catch(e){m({type:"rejected",payload:e.response.data})}}async function b(e,t){try{m({type:"isLoading"});let n=await s.Z.patch("/api/v1/accounts/editExpense/".concat(e),t);if(console.log(n),"success"===n.data.status){let t=a.map(t=>t.id===e?n.data.data.updatedTransaction:t);m({type:"getTransactions",payload:t})}}catch(e){m({type:"rejected",payload:e.response.data})}}async function k(e){try{m({type:"isLoading"});let t=await s.Z.get("/api/v1/accounts/transactions/".concat(e));"success"===t.data.status&&m({type:"getTransactions",payload:t.data.data})}catch(e){m({type:"rejected",payload:y.response.data})}}(0,o.useEffect)(()=>{let e=async()=>{await L(1)};h&&e()},[h]);let P=e=>{if(!window.Razorpay){console.error("Razorpay script is not loaded");return}let t={key:"rzp_test_eMwKYTzL8DP6sN",amount:100,currency:e.currency,name:"premium member",description:"Test Transaction",image:{main:i.default},order_id:e.id,handler:async e=>{try{let{data:t}=await s.Z.post("/api/v1/accounts/verify",e);console.log(t),"success"===t.status?await f(t):(console.error("Payment verification failed:",t.errormessage),alert(t.errormessage))}catch(e){console.log(e)}},theme:{color:"#3399cc"}};new window.Razorpay(t).open()};async function I(){try{let{data:e}=await s.Z.post("/api/v1/accounts/checkout",{amount:100}),t=P(e.data);console.log(t)}catch(e){}console.log(y)}async function T(e){try{m({type:"isLoading"});let t=await s.Z.post("/api/v1/accounts/generatePDF",{transactions:e},{responseType:"json"});if("success"===t.data.status){let e=t.data.data,a=atob(e),n=Array(a.length);for(let e=0;e<a.length;e++)n[e]=a.charCodeAt(e);let o=new Uint8Array(n),s=new Blob([o],{type:"application/pdf"}),r=URL.createObjectURL(s);window.open(r)}else console.error("Failed to generate PDF")}catch(e){m({type:"rejected",payload:e.response.data})}}return(0,n.jsx)(c.Provider,{value:{isLoading:u,transactions:a,deleteExpense:v,balance:p,error:y,addExpense:w,editExpense:b,getTransactionsByCategories:k,razorCheckout:I,generatePDF:T,paginationData:g,fetchTransactions:L},children:t})}let p=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("Unable to find context");return e}},4080:function(e,t,a){"use strict";a.d(t,{UsersProvider:function(){return l},a:function(){return u}});var n=a(7437),o=a(2265),s=a(7084),r=a(2126);let i=(0,o.createContext)(),c={user:{},isLoading:!1,error:{},isAuthenticated:!1,token:"",isAdmin:!1,isLoggedIn:!1,transaction:[],category:[],balance:0,premium:!1};function d(e,t){switch(t.type){case"isLoading":return{...e,isLoading:!0};case"isLoggedIn":return{...e,isLoggedIn:!0,isLoading:!1};case"isAdmin":return{...e,isAdmin:!0};case"isLoggedOut":return{...e,isLoggedIn:!1,isAuthenticated:!1,isAdmin:!1,user:{},transaction:[],token:"",isLoading:!1};case"getUserData":return{user:t.payload,isAuthenticated:!0,isLoggedIn:!0,isLoading:!1};case"rejected":return{...e,isLoading:!1,error:t.payload};case"getToken":return{...e,token:t.payload,isLoading:!1};case"getTransaction":return{...e,transaction:t.payload,isLoading:!1};case"storeUserData":return{...e,user:t.payload,isAuthenticated:!0,isLoggedIn:!0,isLoading:!1};case"getCategory":return{...e,category:t.payload,isLoading:!1};case"getBalance":return{...e,balance:t.payload,isLoading:!1};case"isAuthenticated":return{...e,isAuthenticated:!0,isLoggedIn:!0,isLoading:!1};case"isPremium":return{...e,premium:!0,isLoading:!1};default:return"unknown action type"}}function l(e){let{children:t}=e,[{user:a,isLoading:l,isLoggedIn:u,error:p,token:y,transaction:g,isAuthenticated:m,category:h,getBalance:f,balance:L,isPremium:w},v]=(0,o.useReducer)(d,c);async function b(e){v({type:"isLoading"});try{let t=await r.Z.post("http://localhost:3000/api/v1/users/signup",e);v({type:"getUserData",payload:t.data.data.user}),v({type:"getToken",payload:t.data.token}),v({type:"storeUserData",payload:t.data.data.user}),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.data.user))}catch(e){v({type:"rejected",payload:e.response.data})}}async function k(e){v({type:"isLoading"});try{let t=await r.Z.post("http://localhost:3000/api/v1/users/login",e);v({type:"getUserData",payload:t.data.data.user}),v({type:"getToken",payload:t.data.token}),v({type:"storeUserData",payload:t.data.data.user}),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.data.user))}catch(e){v({type:"rejected",payload:e.response.data})}}async function P(){try{v({type:"isLoading"}),delete s.Z.defaults.headers.common.Authorization,await s.Z.get("/api/v1/users/logout"),v({type:"isLoading",payload:!1}),v({type:"isLoggedOut"}),localStorage.removeItem("token"),localStorage.removeItem("user")}catch(e){v({type:"rejected",payload:e})}}async function I(e){try{v({type:"isLoading"}),"success"===e.status&&v({type:"isPremium"})}catch(e){v({type:"rejected",payload:p.response.data})}}async function T(e){try{v({type:"isLoading"});let t=await r.Z.post("http://localhost:3000/api/v1/users/forgotPassword",e);console.log(t),"success"===t.data.status?alert("Email has been sent to your email: ".concat(t.data.data.user.email)):alert("Failed to send reset email: ".concat(t.data.message))}catch(e){v({type:"rejected",payload:e})}}return(0,o.useEffect)(()=>{let e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"));e&&t&&(v({type:"getToken",payload:e}),v({type:"storeUserData",payload:t}),v({type:"isLoggedIn"}))},[]),(0,o.useEffect)(()=>{async function e(){try{v({type:"isLoading"});let e=await s.Z.get("/api/v1/accounts/getAllCategories");v({type:"getCategory",payload:e.data.data})}catch(e){console.log(e)}}m&&e()},[m]),(0,n.jsx)(i.Provider,{value:{signup:b,login:k,isLoading:l,token:y,error:p,user:a,isLoggedIn:u,transaction:g,logout:P,category:h,balance:L,setPremium:I,forgotPassword:T},children:t})}let u=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("Unable to find context");return e}},7084:function(e,t,a){"use strict";let n=a(2126).Z.create({baseURL:"http://localhost:3000"});n.interceptors.request.use(e=>{let t=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user"));return t&&a?e.headers.Authorization="Bearer ".concat(t):delete e.headers.Authorization,e},e=>Promise.reject(e)),t.Z=n},8877:function(){},5262:function(e,t,a){"use strict";a.r(t),t.default={src:"/_next/static/media/main_manage.67acc567.svg",height:6e3,width:6e3,blurWidth:0,blurHeight:0}}},function(e){e.O(0,[183,218,126,669,265,971,23,744],function(){return e(e.s=6815)}),_N_E=e.O()}]);